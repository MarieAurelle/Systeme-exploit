#include "auxiliaires.h"

					// CE FICHIER CONTIENT LES FONCTIONS AIDANT A LA REALISATION DU PROGRAMME //

/* Permet de renvoyer le nombre lu sur une ligne dans le fichier fd, à la position indiquée (position_deb) */
float lecture_ligne(int fd, int* position_deb){
	
			/// Déclarations des variables ///
	/* verif -> permet de verifier le renvoie du read pour savoir si le fichier contient encore des valeurs,
	 * nombre_ligne -> donne le nombre contenu à la ligne courante, ligne -> stocke les caractères formant 
	 * le nombre lu sur la ligne*/
	int i, verif;
	float nombre_ligne;
	char* ligne;
	
			/// Initialisations ///
	ligne = malloc(sizeof(char)*20);
	
			/// Vérification du contenu du fichier ///
	lseek(fd, *position_deb, SEEK_SET); //se place à la position voulue
	verif = read(fd, ligne, 1); //lecture du premier caractère
	if(verif == 0){ //Vérification si le fichier contient encore des valeurs ou non
		printf("Le fichier est vide\n");
		exit(EXIT_FAILURE);
	}

			/// Lecture d'une ligne ///
	for(i = 0; verif != 0 && ligne[i] != '\n' ; i++){ // Si le verif est bon alors on peut lire la ligne
		verif = read(fd, ligne+(i+1), 1); //lecture d'un caractère
		(*position_deb)++;
	}
			/// Conversion de nombre en chaine de caractère, en float ///
	nombre_ligne = atof(ligne);
	free(ligne);
	return nombre_ligne;
}

/*Cette fonction permet de renvoyer le void* correspondant au char* saisi
 * pour passer en paramètre le code de l'opération que les processus
 * et les threads devront effectuer*/
void* recherche_code(char* code){
	if(strcmp(code, "min") == 0){
		return min;
	}
	else if(strcmp(code, "max") == 0){
		return max;
	}
	else if(strcmp(code, "avg") == 0){
		return avg;
	}
	else if(strcmp(code, "sum") == 0){
		return sum;
	}
	else if(strcmp(code, "odd") == 0){
		return min;
	}
	else{
		printf("mauvais code\n");
		exit(EXIT_FAILURE);
	}
	
}
