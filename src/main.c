#include "process_directeur.h"

					// CE FICHIER CONTIENT L'IMPLEMENTATION DES CREATIONS DE PROCESSUS CHEFS D'EQUIPE/THREADS EMPLOYES //

int main(int argc, char** argv){

			/// Déclarations de toutes les variables ///

	float res = 0.0;
	int nb_fichiers = 0, i;
	char chemin[5] = "./";
	DIR* rep = NULL;
	struct dirent* fichier_lu = NULL;
	char code[3];
	
			/// Demande du nombre de fichiers et du code de fnction à l'utilisateur ///
	
	printf("Donner le nombre de fichiers se trouvant dans le répertoire 'Fichiers' :\n");
	scanf("%d",&nb_fichiers);
	char** noms_fichiers = NULL;
	noms_fichiers = malloc(nb_fichiers*sizeof(char*));
	printf("Donner le code de la fonction à réaliser sur cet ensemble de fichiers :\n");
	scanf("%s", code);
	
			/// Ouverture du chemin pour aller récupérer les fichiers ///
	
	rep = opendir(chemin);
	if(rep == NULL) { //Vérification que le répertoire ait bien été ouvert
		printf("Le répertoire n'a pas été ouvert.\n");
		exit(1);
	}

			/// Stockage du nom des fichiers dans un tableau de chaine de caractères ///

	for(i = 0; i < nb_fichiers; i++){
		fichier_lu = readdir(rep); //lecture du nom du fichier
		if(fichier_lu > 0){
			printf("Il n'y a aucun fichier dans le dossier.\n");
			exit(-1);
		}
		if(closedir(rep) == -1){ // à voir
				exit(-1);
		}
		
		/* Comme notre exécutable se trouve dans ce dossier on compare ce qui est lu
		 * avec le nom de l'excutable pour ne pas le mettre dans les fichiers à ouvrir */
		if(strcmp(fichier_lu->d_name, "reduction") != 0); 
			noms_fichiers[i] = fichier_lu->d_name;
	}

			/// Lancement du processus directeur ///

	res = processus_directeur(code, nb_fichiers, noms_fichiers);

			/// Affichage du résultat ///
	printf("res : %f\n", res);
	
	return 0;
}

