#include "process_chef.h"
					// CE FICHIER CONTIENT LE PROGRAMME DU PROCESSUS DIRECTEUR //


float processus_directeur(void* code, int nb_fichiers, char** fichiers){
	
			/// Déclarations des variables ///
	/* retour -> permet de récupérer la valeur de retour d'un chef (donc d'un processus fils), retour_chef -> tableau
	 * qui permet de stocker les retours des processus fils afin de permettre au processus père d'effectuer un dernier
	 * traitement dessus */
	int i, pid, status;
	float retour;
	float* retour_chef;
	pthread_mutex_t m;
	
			/// Initialisations ///
	retour_chef = malloc(sizeof(float)*nb_fichiers);
	pthread_mutex_init(&m, NULL);

			/// Création des processus chefs ///
	
	for(i=0; i<nb_fichiers; i++){ //pour chaque fichier on créé un processus chef
		pid = fork();
		if(pid == 0){ //quand on est dans le processus fils, on lance la fonction chef sur un fichier donné
			retour = chef(code, fichiers[i]);
			exit(retour);
		} else { //dans le père on attend la fin de l'éxecution des processus fils puis on stocke le retour dans un tableau
			wait(&status);
			if(WIFEXITED(status)){
				retour_chef[i] = WEXITSTATUS(status);
			} else {
				printf("ERROR\n");
			}
		}
	}
	
			/// Dernier traitement pour trouver le résultat final ///
	int res_final = min_tab(nb_fichiers, retour_chef);
	free(retour_chef);

	return res_final;
	
}


